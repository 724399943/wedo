<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title><block name="title">{:C('systemName')}</block><block name="suffix"></block></title>
    <meta name="renderer" content="webkit">
    <meta name="description" content="<block name="description"></block>">
    <meta name="keywords" content="<block name="keywords"></block>">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <link rel="shortcut icon" href="__PUBLIC__/xcrozz.ico" type="image/x-icon">
    <link href="__PUBLIC__/Shop/css/base.css" rel="stylesheet">
    <link href="__PUBLIC__/Shop/css/style.css" rel="stylesheet">
    <script src="__PUBLIC__/Wechat/js/jquery-1.8.3.min.js" type="text/javascript"></script>
    <link href="__PUBLIC__/Shop/css/login.css" rel="stylesheet">
    <style type="text/css">
        body{background: #fff;}
        .in-box.stype{border:none;overflow: hidden;}
        .in-box .itit{color:#666;float: left;}
        .in-box.stype input{width:180px;border:none;height:40px;line-height:40px;font-size:14px;color:#666;text-align:right;float: left;}
        .paper_wrap{margin-top:11%;background:#fff;height:20%;position:relative;height:160px;}
        .paper_wrap p{width:100%;text-align:center;color:#999;position:absolute;top:50%;left:0;-webkit-transform:translateY(-50%);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
        .paper_wrap .papers_box{width:100%;height:100%;position:absolute;top:0;left:0;}
        .paper_wrap .papers_box img{width:100%;height:100%;}
        .paper_wrap input{width:100%;height:100%;position:absolute;top:0;left:0;opacity:0;}
        .smask{position:fixed;top:0;left:0;right:0;bottom:0;overflow:auto;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;}
        .storeTypeBox{padding:15px 50px;border:1px solid #333;width:50%;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);background:#fff;display:none;}
        .storeTypeBox h1{text-align:center;font-size:20px;color:#333;}
        .storeTypeBox ul {border:1px solid #e4e4e4;overflow:hidden;margin-top:10px;}
        .storeTypeBox ul li{float:left;line-height:40px;color:#666;overflow:hidden;border-bottom:1px solid #e4e4e4;border-right:1px solid #e4e4e4;margin-right:-1px;margin-bottom:-1px;width:44%;padding:0 3%;position:relative;}
        .storeTypeBox ul li span{float:left;}
        .storeTypeBox ul li input{width:20px;height:20px;float:right;position:absolute;top:50%;right:3%;transform:translateY(-50%);-webkit-transform:translateY(-50%);}
        .storeTypeBox .sbtn{display:block;width:220px;height:40px;line-height:40px;border:1px solid #e4e4e4;border-radius:5px;margin:15px auto;text-align:center;}
        .storeTypeBox .sbtn:hover{background:rgba(22, 155, 213, 1);color:#fff;border:1px solid rgba(22,155,213,1);}
        .storeTypeBox .pt{text-align:center;}
    </style>
</head>
<div class="login-box">
    <div class="l-top">
        <a href="/" class="logo">
            <img src="__PUBLIC__/Shop/images/okshop_logo.png" width="134" alt="">
        </a>
    </div>
    <div class="box clearfix">
        <img src="__PUBLIC__/Shop/images/loginpic.jpg" alt="" class="pic">
        <div class="login-input-b">
            <div class="login-data login-sigin-data">
                <div class="tit">{$Think.lang._WAP_SUPPLEMENT_ADDINFORMATION_}</div>
                <form action="" method="post" id="Jform">
                    <div class="in-box">
                        <input name="company_name" placeholder="{$Think.lang._PC_USER_COMPANY_NAME_}" type="text" class="text" value="{$_GET['company_name']}" >
                        <span class="true"></span>
                    </div>
                    <div class="in-box">
                        <input name="registr_id" placeholder="{$Think.lang._PC_USER_LICENSE_NUMBER_}" type="text" class="text" value="{$_GET['registr_id']}" >
                    </div>
                    <div class="in-box">
                        <input name="address" placeholder="{$Think.lang._PC_USER_COMPANY_ADDRESS_}" type="text" class="text" id="address">
                        <input type="hidden" name="longitude" id="longitude">
                        <input type="hidden" name="latitude" id="latitude">
                    </div>
                    <div class="in-box">
                        <input name="manager" placeholder="{$Think.lang._PC_USER_CONTACT_PERSON_NAME_}" type="text" class="text" value="{$_GET['manager']}">
                    </div>
                    <div class="in-box">
                        <input name="email" placeholder="{$Think.lang._PC_USER_CONTACT_PERSON_EMAIL_}" type="text" class="text" value="{$_GET['email']}">
                    </div>
                    <div class="in-box">
                        <input name="telephone" placeholder="{$Think.lang._PC_USER_CONTACT_NUMBER_}" type="text" class="text" value="{$_GET['telephone']}">
                    </div>
                    <div class="in-box">
                        <input name="agent_phone" placeholder="{$Think.lang._PC_USER_MERCHANT_NUMBER_}" type="text" class="text" value="{$_GET['agent_phone']}">
                    </div>
                    <div class="in-box stype" id="chooseStype">
                        <span class="itit">{$Think.lang._PC_USER_MERCHANT_CATEGORIES_}：</span>
                        <input type="text" readonly="readonly" placeholder="{$Think.lang._COMMON_ALL_}{$Think.lang._PC_USER_MERCHANT_CATEGORIES_}" id="KcategoryName" value="{$_GET['category_name']}">
                        <input type="hidden" name="categoryids" id="Kcategoryids" value="{$_GET['categoryids']}">
                    </div>
                    <div class="paper_wrap" id="filePicker">
                        <p>{$Think.lang._WAP_SUPPLEMENT_UPLOADDOCUMENTS_}</p>
                        <div class="papers_box">
                             <img src="{$_GET['license']}" alt="" id="uploadImg">
                        </div>
                        <input type="hidden" name="license" value="{$_GET['license']}" id="hiddenImg">
                        <input type="file" name="upload_input" id="upload_input">
                    </div>
                    <input type="hidden" name="user_id" value="{$_GET['user_id']}">
                    <input type="hidden" name="type" value="0" />
                    <input type="hidden" name="sendType" id="JSendType" value="" />
                    <a href="javascript:;" id="Jsbumit" class="conment-login">{$Think.lang._COMMON_SUBMIT_}</a>
                    <a href="#">{$Think.lang._PC_LOGIN_REGISTER_ANY_PROBLEM_}</a>
                </form>
            </div>
        </div>
    </div>
</div>
<!--  提示信息 -->
<div class="tips" id="tips">
    <span class="ico"></span>
    <span class="txt">键盘大写锁定已打开，请注意大小写</span> <em></em>
</div>
<!-- 弹选择分类 -->
<div class="smask"></div>
<div class="storeTypeBox">
    <h1>{$Think.lang._WAP_SUPPLEMENT_CHOOSECATEGORY_}</h1>
    <ul id="sTypeUl"></ul>
    <a href="javascript:;" class="sbtn" id="JsbType">{$Think.lang._COMMON_CONFIRM_}</a>
    <p class="pt">{$Think.lang._WAP_SUPPLEMENT_TIPS_}</p>
</div>
<script src="__PUBLIC__/Shop/js/baiduTemplate.js" type="text/javascript"></script>
<script type="text/javascript" src="__PUBLIC__/Common/js/ajaxfileupload.js"></script>
<script id="category_tpl" type="text/html">
<%for(var i=0; i<list.length; i++){%>
    <%var data = list[i];%>
    <li>
        <span><%=data['category_name']%></span>
        <input type="checkbox" data-name="<%=data['category_name']%>" data-id="<%=data['id']%>">
    </li>
<%}%>
</script>
<script type="text/javascript">
    var bt = baidu.template;
    var cateData = [],  //选择分类 
        idData = [];
    var address = "{$_GET['address']}",
        longitude = "{$_GET['lng']}",
        latitude = "{$_GET['lat']}";
    if ( address ) {
        $('#address').val(address);
    }
    if ( longitude ) {
        $('#longitude').val(longitude);
    }
    if ( latitude ) {
        $('#latitude').val(latitude);
    }

    function initAgentCategory(){
        $.ajax({
            url: '{:U('Category/agentCategory')}',
            type: "POST",
            dataType: 'json',
            data: {}
        })
        .done(function(returnData) {
            if(returnData['status'] == 200000){
                var html = bt('category_tpl', returnData['data']);
                $('#sTypeUl').html(html);
            }
        })
    }
    initAgentCategory();

    $('.in-box .text').on({
        blur:function(event) {
            $(this).parent('.in-box').removeClass('blur-box');
        },
        focus:function(event) {
            $(this).parent('.in-box').addClass('blur-box');
        }
    });

    // 显示商家分类
    $("#chooseStype").click(function(){
        $(".smask").show();
        $(".storeTypeBox").show();
    })

    $("#JsbType").click(function(){
        $(".smask").hide();
        $(".storeTypeBox").hide();
        $('#KcategoryName').val(cateData.join(','));
        $('#Kcategoryids').val(idData.join(','));
    })

    $(document).click(function(e){ 
        e = window.event || e; 
        obj = $(e.srcElement || e.target);
        if ($(obj).is(".smask")) { 
            $(".smask").hide();
            $(".storeTypeBox").hide();
        }
    });

    // 选择商家分类
    $("#sTypeUl").on('change','input',function(){
        if( cateData.length >= 3 ){
            $(this).attr("checked",false);
        }
        var name = $(this).data('name'),
            id = $(this).data('id');
        if( $(this).attr('checked') ){
            cateData.push(name);
            idData.push(id);
        }else{
            for(var i = 0;i < cateData.length;i++){
                if(cateData[i].indexOf(name) != -1){
                    cateData.splice(i,1);
                }
            }
            for(var i = 0;i < idData.length;i++){
                if(idData[i].indexOf(id) != -1){
                    idData.splice(i,1);
                }
            }
        }
    })

    // 提交资料
    $("#Jsbumit").click(function(){
        $.ajax({
            url : "{:U("Agent/completeAgent")}",
            type : "POST",
            dataType : "json",
            data : $('#Jform').serialize()
        })
        .done(function(returnData){
            if(returnData['status'] == '200000'){
                window.location.href = "{:U('Agent/completeSuccess')}?qrcode="+returnData['data']['agentQRcode'];
            }else{
                alert(returnData.message);
            }
        })
    })

    // 上传图片
    $(document).on('change', '#upload_input', function() {
        $.ajaxFileUpload({
            url: "{:U('Agent/photoUpload')}",
            secureuri: false,
            fileElementId: 'upload_input',
            dataType: 'json',
            success: function (data, status) {
                if(data.error != '') {
                    alert(data.errorStr);
                } else {
                    $("#uploadImg").attr("src",data.url);
                    $("#hiddenImg").val(data.url);
                }
            },error: function (data, status, e) {
                alert(e);
            }
        });
    });

    // 定位
    $('#address').click(function(){
        var company_name = $('input[name="company_name"]').val()
            ,registr_id = $('input[name="registr_id"]').val()
            ,manager = $('input[name="manager"]').val()
            ,email = $('input[name="email"]').val()
            ,telephone = $('input[name="telephone"]').val()
            ,agent_phone = $('input[name="agent_phone"]').val()
            ,category_name = $('#KcategoryName').val()
            ,categoryids = $('input[name="categoryids"]').val()
            ,license = $('input[name="license"]').val(),
            jumpUrl = "{:U('Agent/location')}?jump=1";
        if ( company_name ) {
            jumpUrl += "&company_name=" + company_name;
        }
        if ( registr_id ) {
            jumpUrl += "&registr_id=" + registr_id;
        }
        if ( manager ) {
            jumpUrl += "&manager=" + manager;
        }
        if ( email ) {
            jumpUrl += "&email=" + email;
        }
        if ( telephone ) {
            jumpUrl += "&telephone=" + telephone;
        }
        if ( agent_phone ) {
            jumpUrl += "&agent_phone=" + agent_phone;
        }
        if ( category_name ) {
            jumpUrl += "&category_name=" + category_name;
        }
        if ( categoryids ) {
            jumpUrl += "&categoryids=" + categoryids;
        }
        if ( license ) {
            jumpUrl += "&license=" + license;
        }
        window.location.href = jumpUrl;
    });
</script>